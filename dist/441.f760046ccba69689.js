"use strict";(self.webpackChunksky_calendar_app=self.webpackChunksky_calendar_app||[]).push([[441],{4441:function(se,C,i){i.r(C),i.d(C,{AuthLayoutModule:function(){return ae}});var g=i(3144),f=i(5671),h=i(4035),P=i(9808),a=i(2382),b=i(4244),y=i(7556),e=i(4893),x=new b.N0,I=function(){var r=function(){function t(n,o){(0,f.Z)(this,t),this.router=n,this.authService=o}return(0,g.Z)(t,[{key:"canActivate",value:function(){if(console.log("Auth Guard Check Login"),null===localStorage.getItem("user"))return localStorage.removeItem("user"),!0;if(x.decodeToken(JSON.parse(localStorage.getItem("user")).token.firstLogin))return localStorage.removeItem("user"),!0;switch(console.log("El rol es ",this.authService.getItemToken("role")),this.authService.getItemToken("role")){case"admin":this.router.navigateByUrl("/calendar-admin");break;case"viewer":this.router.navigateByUrl("/calendar-view");break;default:this.router.navigateByUrl("/login"),localStorage.removeItem("user")}}}]),t}();return r.\u0275fac=function(n){return new(n||r)(e.LFG(h.F0),e.LFG(y.e))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r}(),A=i(7757),p=i.n(A),k=i(1431),F=i(5020),L=i(5226),S=i.n(L),T=i(2290),_=function(r,t,n,o){return new(n||(n=Promise))(function(l,c){function Z(u){try{m(o.next(u))}catch(w){c(w)}}function v(u){try{m(o.throw(u))}catch(w){c(w)}}function m(u){u.done?l(u.value):function s(l){return l instanceof n?l:new n(function(c){c(l)})}(u.value).then(Z,v)}m((o=o.apply(r,t||[])).next())})};function N(r,t){1&r&&(e.TgZ(0,"small",31),e._uU(1," Debe ingresar un Email valido"),e.qZA())}function J(r,t){1&r&&(e.TgZ(0,"small",32),e._uU(1," Se requiere ingresar Email"),e.qZA())}function q(r,t){if(1&r&&(e.TgZ(0,"div"),e.YNc(1,N,2,0,"small",29),e.YNc(2,J,2,0,"small",30),e.qZA()),2&r){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",null==n.loginForm.controls.username.errors?null:n.loginForm.controls.username.errors.email),e.xp6(1),e.Q6J("ngIf",null==n.loginForm.controls.username.errors?null:n.loginForm.controls.username.errors.required)}}function U(r,t){1&r&&(e.TgZ(0,"small",35),e._uU(1," La longitud minima es 6 caracteres"),e.qZA())}function O(r,t){1&r&&(e.TgZ(0,"small",36),e._uU(1," Se requiere ingresar password"),e.qZA())}function E(r,t){if(1&r&&(e.TgZ(0,"div"),e.YNc(1,U,2,0,"small",33),e.YNc(2,O,2,0,"small",34),e.qZA()),2&r){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",null==n.loginForm.controls.password.errors?null:n.loginForm.controls.password.errors.minlength),e.xp6(1),e.Q6J("ngIf",null==n.loginForm.controls.password.errors?null:n.loginForm.controls.password.errors.required)}}var Y=function(){var r=function(){function t(n,o,s,l){(0,f.Z)(this,t),this.authService=n,this.fb=o,this.router=s,this.toastrService=l,this.show_button=!1,this.show_eye=!1,this.userStorage=localStorage.getItem("username"),this.enableFingerPrint=null==localStorage.getItem("verified")||"null"==localStorage.getItem("verified")}return(0,g.Z)(t,[{key:"ngOnInit",value:function(){localStorage.removeItem("user"),this.crearFormularioLogin(),this.loginForm.controls.username.setValue(null==this.userStorage?"":this.userStorage)}},{key:"showPassword",value:function(){this.show_button=!this.show_button,this.show_eye=!this.show_eye}},{key:"crearFormularioLogin",value:function(){this.loginForm=this.fb.group({username:new a.NI("",[a.kI.required,a.kI.email,a.kI.minLength(6),a.kI.maxLength(50)]),password:new a.NI("",[a.kI.required,a.kI.minLength(6)])})}},{key:"onLogin",value:function(){var o=this;this.authService.login(this.loginForm.value).subscribe({next:function(l){l.message==F.s.MENSAJE_OK?o.validateLogin(l):o.toastrService.error(l.message,"Error",{timeOut:3e3})},error:function(l){o.toastrService.error("Error al logearse"+l,"Error",{timeOut:3e3})}})}},{key:"validateLogin",value:function(o){o.firstLogin?this.alertFirstLogin():(this.loginForm.value.username!==this.userStorage&&localStorage.setItem("verified","null"),localStorage.setItem("username",this.loginForm.value.username),this.router.navigate("admin"==o.role?["/calendar-admin"]:["/calendar-view"]))}},{key:"alertFirstLogin",value:function(){var o=this;S().fire({title:"Es su primer login",text:"Se recomienda cambiar su contrase\xf1a",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Confirmar",cancelButtonText:"Cancelar"}).then(function(s){s.isConfirmed?o.router.navigate(["/change-password"]):localStorage.removeItem("user")})}},{key:"startAuthentication",value:function(){return _(this,void 0,void 0,p().mark(function o(){var s=this;return p().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:this.authService.startAuthentication(this.userStorage).subscribe({next:function(v){return _(s,void 0,void 0,p().mark(function m(){var u;return p().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,d.t0=k.oz,d.next=4,v;case 4:return d.t1=d.sent,d.next=7,(0,d.t0)(d.t1);case 7:u=d.sent,Object.assign(u,{username:this.userStorage}),this.verifityAuthentication(u),d.next=15;break;case 12:d.prev=12,d.t2=d.catch(0),this.toastrService.error("Sucedio un error al intentar autenticarse","Error",{timeOut:3e3});case 15:case"end":return d.stop()}},m,this,[[0,12]])}))},error:function(v){s.toastrService.error("Sucedio un error al intentar autenticarse","Error",{timeOut:3e3})}});case 1:case"end":return c.stop()}},o,this)}))}},{key:"verifityAuthentication",value:function(o){var s=this;console.log("Envie desde Angular",o),this.authService.verifityAuthentication(o).subscribe({next:function(c){console.log("Autentificacion OK",c),c.verified?s.validateLogin(c.data):s.toastrService.error("Error al logearse","Error",{timeOut:3e3})},error:function(c){console.log("Error al logearme ",c),s.toastrService.error("Error al logearse","Error",{timeOut:3e3})}})}}]),t}();return r.\u0275fac=function(n){return new(n||r)(e.Y36(y.e),e.Y36(a.qu),e.Y36(h.F0),e.Y36(T._W))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-login"]],decls:40,vars:8,consts:[[1,"header","bg-primary","py-7","py-lg-8"],[1,"container"],[1,"header-body","text-center","mb-7"],[1,"row","justify-content-center"],[1,"col-lg-5","col-md-6"],[1,"text-white"],[1,"container","mt--8","pb-5"],[1,"col-lg-5","col-md-7"],[1,"card","bg-secondary","shadow","border-0"],[1,"card-header","bg-transparent","pb-5"],[1,"card-body","px-lg-5","py-lg-5"],[1,"text-center","text-muted","mb-4"],["role","form",3,"formGroup"],[1,"form-group","mb-3"],[1,"input-group","input-group-alternative"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"ni","ni-email-83"],["formControlName","username","maxlength","50","placeholder","Email","type","email",1,"form-control"],[4,"ngIf"],[1,"form-group"],[1,"ni","ni-lock-circle-open"],["autocomplete","off","formControlName","password","placeholder","Password",1,"form-control",3,"type"],["id","showPassword",1,"input-group-prepend","pointer",3,"click"],["id","eye"],[1,"text-center"],["type","submit",1,"btn","btn-primary","my-4",3,"disabled","click"],[1,"btn","btn-primary","my-4",2,"bottom","35px",3,"disabled","click"],[1,"fas","fa-fingerprint"],["id","validEmail","class","text-left",4,"ngIf"],["id","requiredEmail","class","text-left",4,"ngIf"],["id","validEmail",1,"text-left"],["id","requiredEmail",1,"text-left"],["id","minLenghtPass","class","text-left",4,"ngIf"],["id","requiredPass","class","text-left",4,"ngIf"],["id","minLenghtPass",1,"text-left"],["id","requiredPass",1,"text-left"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h1",5),e._uU(6,"Bienvenido!"),e.qZA()()()()()(),e.TgZ(7,"div",6)(8,"div",3)(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"div",11)(14,"p"),e._uU(15,"Ingrese sus credenciales"),e.qZA()(),e.TgZ(16,"form",12)(17,"div",13)(18,"div",14)(19,"div",15)(20,"span",16),e._UZ(21,"em",17),e.qZA()(),e._UZ(22,"input",18),e.qZA(),e.YNc(23,q,3,2,"div",19),e.qZA(),e.TgZ(24,"div",20)(25,"div",14)(26,"div",15)(27,"span",16),e._UZ(28,"em",21),e.qZA()(),e._UZ(29,"input",22),e.TgZ(30,"div",23),e.NdJ("click",function(){return o.showPassword()}),e.TgZ(31,"span",16),e._UZ(32,"em",24),e.qZA()()(),e.YNc(33,E,3,2,"div",19),e.qZA(),e.TgZ(34,"div",25)(35,"button",26),e.NdJ("click",function(){return o.onLogin()}),e._uU(36,"Login"),e.qZA()(),e.TgZ(37,"div",25)(38,"button",27),e.NdJ("click",function(){return o.startAuthentication()}),e._UZ(39,"em",28),e.qZA()()()()()()()()()),2&n&&(e.xp6(16),e.Q6J("formGroup",o.loginForm),e.xp6(7),e.Q6J("ngIf",o.loginForm.controls.username.invalid&&o.loginForm.controls.username.touched),e.xp6(6),e.Q6J("type",o.show_button?"text":"password"),e.xp6(3),e.Tol(o.show_eye?"ni fa fa-eye":"ni fa fa-eye-slash"),e.xp6(1),e.Q6J("ngIf",o.loginForm.controls.password.invalid&&o.loginForm.controls.password.touched),e.xp6(2),e.Q6J("disabled",o.loginForm.invalid),e.xp6(3),e.Q6J("disabled",o.enableFingerPrint))},directives:[a._Y,a.JL,a.sg,a.Fj,a.JJ,a.u,a.nD,P.O5],styles:[".text-left[_ngcontent-%COMP%] {\n  color: red;\n}\n\n.pointer[_ngcontent-%COMP%] {\n  cursor: pointer !important;\n}"]}),r}();function Q(r,t){1&r&&(e.TgZ(0,"small",35),e._uU(1," La longitud minima es 6 caracteres"),e.qZA())}function M(r,t){1&r&&(e.TgZ(0,"small",36),e._uU(1," Se requiere ingresar contrase\xf1a actual"),e.qZA())}function R(r,t){if(1&r&&(e.TgZ(0,"div"),e.YNc(1,Q,2,0,"small",33),e.YNc(2,M,2,0,"small",34),e.qZA()),2&r){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",null==n.changePasswordForm.controls.oldPassword.errors?null:n.changePasswordForm.controls.oldPassword.errors.minlength),e.xp6(1),e.Q6J("ngIf",null==n.changePasswordForm.controls.oldPassword.errors?null:n.changePasswordForm.controls.oldPassword.errors.required)}}function B(r,t){1&r&&(e.TgZ(0,"small",39),e._uU(1," La longitud minima es 6 caracteres "),e.qZA())}function j(r,t){1&r&&(e.TgZ(0,"small",40),e._uU(1," Se requiere ingresar nueva contrase\xf1a "),e.qZA())}function G(r,t){if(1&r&&(e.TgZ(0,"div"),e.YNc(1,B,2,0,"small",37),e.YNc(2,j,2,0,"small",38),e.qZA()),2&r){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",null==n.changePasswordForm.controls.newPassword.errors?null:n.changePasswordForm.controls.newPassword.errors.minlength),e.xp6(1),e.Q6J("ngIf",null==n.changePasswordForm.controls.newPassword.errors?null:n.changePasswordForm.controls.newPassword.errors.required)}}function z(r,t){1&r&&(e.TgZ(0,"small",43),e._uU(1," La longitud minima es 6 caracteres"),e.qZA())}function X(r,t){1&r&&(e.TgZ(0,"small",44),e._uU(1," Se requiere ingresar confirmar nueva contrase\xf1a"),e.qZA())}function K(r,t){if(1&r&&(e.TgZ(0,"div"),e.YNc(1,z,2,0,"small",41),e.YNc(2,X,2,0,"small",42),e.qZA()),2&r){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",null==n.changePasswordForm.controls.confirmedPassword.errors?null:n.changePasswordForm.controls.confirmedPassword.errors.minlength),e.xp6(1),e.Q6J("ngIf",null==n.changePasswordForm.controls.confirmedPassword.errors?null:n.changePasswordForm.controls.confirmedPassword.errors.required)}}function $(r,t){1&r&&(e.TgZ(0,"div")(1,"small",45),e._uU(2," La nueva contrase\xf1a y confirmacion contrase\xf1a no coinciden"),e.qZA()())}new b.N0;var V=[{path:"login",component:Y,canActivate:[I]},{path:"change-password",component:function(){var r=function(){function t(n,o,s,l){(0,f.Z)(this,t),this.authService=n,this.fb=o,this.router=s,this.toastrService=l,this.diferent=!1,this.show_button=[!1,!1,!1],this.show_eye=[!1,!1,!1]}return(0,g.Z)(t,[{key:"ngOnInit",value:function(){this.crearFormChangePassword()}},{key:"crearFormChangePassword",value:function(){this.changePasswordForm=this.fb.group({oldPassword:new a.NI("",[a.kI.required,a.kI.minLength(6)]),newPassword:new a.NI("",[a.kI.required,a.kI.minLength(6)]),confirmedPassword:new a.NI("",[a.kI.required,a.kI.minLength(6)])})}},{key:"showPassword",value:function(o){switch(o){case 0:this.show_button[0]=!this.show_button[0],this.show_eye[0]=!this.show_eye[0];break;case 1:this.show_button[1]=!this.show_button[1],this.show_eye[1]=!this.show_eye[1];break;case 2:this.show_button[2]=!this.show_button[2],this.show_eye[2]=!this.show_eye[2]}}},{key:"onChangePassword",value:function(){var o=this;this.diferent=!1,this.changePasswordForm.value.newPassword===this.changePasswordForm.value.confirmedPassword?this.authService.changePassword(this.changePasswordForm.value).subscribe({next:function(l){if(l.message==F.s.MENSAJE_OK)if(o.authService.getItemToken("firstLogin"))o.authService.logout(),o.router.navigate(["/login"]),o.toastrService.success("Se cambio con exitosa la contrase\xf1a","Exito",{timeOut:3e3});else switch(o.toastrService.success("Se cambio con exitosa la contrase\xf1a","Exito",{timeOut:3e3}),o.authService.getItemToken("role")){case"admin":o.router.navigate(["/calendar-admin"]);break;case"estudiante":o.router.navigate(["/calendar-view"])}else o.toastrService.error(l.message,"Error",{timeOut:3e3})},error:function(l){o.toastrService.error("Error al cambiar contrase\xf1a "+l,"Error",{timeOut:5e3})}}):this.diferent=!0}},{key:"retrocederFirstLogin",value:function(){if(this.authService.getItemToken("firstLogin"))this.authService.logout(),this.router.navigate(["/login"]);else switch(this.authService.getItemToken("role")){case"admin":this.router.navigate(["/calendar-admin"]);break;case"viewer":this.router.navigate(["/calendar-view"])}}}]),t}();return r.\u0275fac=function(n){return new(n||r)(e.Y36(y.e),e.Y36(a.qu),e.Y36(h.F0),e.Y36(T._W))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-change-password"]],decls:53,vars:15,consts:[[1,"header","bg-primary","py-7","py-lg-8"],[1,"container"],[1,"header-body","text-center","mb-7"],[1,"row","justify-content-center"],[1,"col-lg-5","col-md-6"],[1,"text-white"],[1,"separator","separator-bottom","separator-skew","zindex-100"],["x","0","y","0","viewBox","0 0 2560 100","preserveAspectRatio","none","version","1.1","xmlns","http://www.w3.org/2000/svg"],["points","2560 0 2560 100 0 100",1,"fill-default"],[1,"container","mt--8","pb-5"],[1,"col-lg-6","col-md-8"],[1,"card","bg-secondary","shadow","border-0"],[1,"card-body","px-lg-5","py-lg-5"],["role","form",3,"formGroup","ngSubmit"],[1,"form-group"],[1,"input-group","input-group-alternative","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"ni","ni-lock-circle-open"],["formControlName","oldPassword","placeholder","Contrase\xf1a Actual",1,"form-control",3,"type"],["id","showOldPassword",1,"input-group-prepend","pointer",3,"click"],["id","eyeOldPassword"],[4,"ngIf"],["formControlName","newPassword","placeholder","Nueva Contrase\xf1a",1,"form-control",3,"type"],["id","showNewPassword",1,"input-group-prepend","pointer",3,"click"],["id","eyeNewPassword"],[1,"input-group","input-group-alternative"],["formControlName","confirmedPassword","placeholder","Confirme Nueva Contrase\xf1a",1,"form-control",3,"type"],["id","showConfirmPassword",1,"input-group-prepend","pointer",3,"click"],["id","eyeConfirmPassword"],[1,"text-center"],["id","atras","type","button",1,"btn","btn-secondary","mt-4",3,"click"],["type","submit",1,"btn","btn-primary","mt-4",3,"disabled"],["id","msgOldPasswordMin","class","text-left",4,"ngIf"],["id","msgOldPasswordReq","class","text-left",4,"ngIf"],["id","msgOldPasswordMin",1,"text-left"],["id","msgOldPasswordReq",1,"text-left"],["id","msgNewPassMin","class","text-left",4,"ngIf"],["id","msgNewPassReq","class","text-left",4,"ngIf"],["id","msgNewPassMin",1,"text-left"],["id","msgNewPassReq",1,"text-left"],["id","msgConfirPassMin","class","text-left",4,"ngIf"],["id","msgConfirPassReq","class","text-left",4,"ngIf"],["id","msgConfirPassMin",1,"text-left"],["id","msgConfirPassReq",1,"text-left"],["id","samePass",1,"text-left"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"strong")(6,"h1",5),e._uU(7,"Cambio de Contrase\xf1a"),e.qZA()()()()()(),e.TgZ(8,"div",6),e.O4$(),e.TgZ(9,"svg",7),e._UZ(10,"polygon",8),e.qZA()()(),e.kcU(),e.TgZ(11,"div",9)(12,"div",3)(13,"div",10)(14,"div",11)(15,"div",12)(16,"form",13),e.NdJ("ngSubmit",function(){return o.onChangePassword()}),e.TgZ(17,"div",14)(18,"div",15)(19,"div",16)(20,"span",17),e._UZ(21,"i",18),e.qZA()(),e._UZ(22,"input",19),e.TgZ(23,"div",20),e.NdJ("click",function(){return o.showPassword(0)}),e.TgZ(24,"span",17),e._UZ(25,"i",21),e.qZA()()(),e.YNc(26,R,3,2,"div",22),e.qZA(),e.TgZ(27,"div",14)(28,"div",15)(29,"div",16)(30,"span",17),e._UZ(31,"i",18),e.qZA()(),e._UZ(32,"input",23),e.TgZ(33,"div",24),e.NdJ("click",function(){return o.showPassword(1)}),e.TgZ(34,"span",17),e._UZ(35,"i",25),e.qZA()()(),e.YNc(36,G,3,2,"div",22),e.qZA(),e.TgZ(37,"div",14)(38,"div",26)(39,"div",16)(40,"span",17),e._UZ(41,"i",18),e.qZA()(),e._UZ(42,"input",27),e.TgZ(43,"div",28),e.NdJ("click",function(){return o.showPassword(2)}),e.TgZ(44,"span",17),e._UZ(45,"i",29),e.qZA()()(),e.YNc(46,K,3,2,"div",22),e.qZA(),e.YNc(47,$,3,0,"div",22),e.TgZ(48,"div",30)(49,"button",31),e.NdJ("click",function(){return o.retrocederFirstLogin()}),e._uU(50,"Atras"),e.qZA(),e.TgZ(51,"button",32),e._uU(52,"Cambiar Contrase\xf1a"),e.qZA()()()()()()()()),2&n&&(e.xp6(16),e.Q6J("formGroup",o.changePasswordForm),e.xp6(6),e.Q6J("type",o.show_button[0]?"text":"password"),e.xp6(3),e.Tol(o.show_eye[0]?"ni fa fa-eye":"ni fa fa-eye-slash"),e.xp6(1),e.Q6J("ngIf",o.changePasswordForm.controls.oldPassword.invalid&&o.changePasswordForm.controls.oldPassword.touched),e.xp6(6),e.Q6J("type",o.show_button[1]?"text":"password"),e.xp6(3),e.Tol(o.show_eye[1]?"ni fa fa-eye":"ni fa fa-eye-slash"),e.xp6(1),e.Q6J("ngIf",o.changePasswordForm.controls.newPassword.invalid&&o.changePasswordForm.controls.newPassword.touched),e.xp6(6),e.Q6J("type",o.show_button[2]?"text":"password"),e.xp6(3),e.Tol(o.show_eye[2]?"ni fa fa-eye":"ni fa fa-eye-slash"),e.xp6(1),e.Q6J("ngIf",o.changePasswordForm.controls.confirmedPassword.invalid&&o.changePasswordForm.controls.confirmedPassword.touched),e.xp6(1),e.Q6J("ngIf",o.diferent),e.xp6(4),e.Q6J("disabled",o.changePasswordForm.invalid))},directives:[a._Y,a.JL,a.sg,a.Fj,a.JJ,a.u,P.O5],styles:[".text-left[_ngcontent-%COMP%] {\n  color: red;\n}"]}),r}(),canActivate:[i(6951).C]}],H=i(1793),ee=i(8274),oe=i(1134),re=i(1520),ne=i(8567),te=i(1321),ae=function(){var r=(0,g.Z)(function t(){(0,f.Z)(this,t)});return r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[P.ez,oe.zk.forRoot(),H.P4.forRoot(),h.Bz.forChild(V),a.u5,re.IJ,a.UX,ne.JX,te.ii.forRoot(),ee.mr.forRoot()]]}),r}()}}]);